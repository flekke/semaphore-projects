---
- name: Run Terraform
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Clone Terraform code
      git:
        repo: https://github.com/flekke/semaphore-projects.git
        dest: /tmp/tf-project
        version: main
        force: yes

    - name: Run terraform init
      shell: terraform init
      args:
        chdir: /tmp/tf-project/terraform

    - name: Run terraform apply
      ansible.builtin.shell: terraform apply -auto-approve
      args:
        chdir: /tmp/tf-project/terraform
      environment:
        OS_CLIENT_CONFIG_FILE: "/home/ubuntu/.config/openstack/clouds.yaml"
